<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control Center | NeuroHarmonics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-body">
    <div class="admin-wrap">
        <aside class="admin-sidebar">
            <h2 class="admin-logo">Neuro<span>Harmonics</span></h2>
            <p class="admin-sub">ADMIN</p>
            <nav class="admin-nav">
                <button type="button" class="admin-nav-btn active" data-section="dashboard"><i class="fas fa-chart-pie"></i> Dashboard</button>
                <button type="button" class="admin-nav-btn" data-section="users"><i class="fas fa-users"></i> Users</button>
                <button type="button" class="admin-nav-btn" data-section="emotions"><i class="fas fa-smile"></i> Emotion Logs</button>
                <button type="button" class="admin-nav-btn" data-section="features"><i class="fas fa-sliders-h"></i> Features</button>
                <button type="button" class="admin-nav-btn" data-section="recommendations"><i class="fas fa-star"></i> Recommendations</button>
                <button type="button" class="admin-nav-btn" data-section="logs"><i class="fas fa-list-alt"></i> Logs</button>
            </nav>
            <a href="/" class="admin-back"><i class="fas fa-arrow-left"></i> Back to site</a>
        </aside>

        <main class="admin-main">
            <!-- Dashboard -->
            <section id="section-dashboard" class="admin-section active">
                <h1>Dashboard</h1>
                <p class="admin-subtitle">Analytics overview</p>
                <div class="admin-cards">
                    <div class="admin-card glass">
                        <div class="admin-card-icon"><i class="fas fa-users"></i></div>
                        <div class="admin-card-value" id="stat-users">{{ analytics.total_users }}</div>
                        <div class="admin-card-label">Total Users</div>
                    </div>
                    <div class="admin-card glass">
                        <div class="admin-card-icon"><i class="fas fa-brain"></i></div>
                        <div class="admin-card-value" id="stat-scans">{{ analytics.total_emotion_scans }}</div>
                        <div class="admin-card-label">Emotion Scans</div>
                    </div>
                    <div class="admin-card glass">
                        <div class="admin-card-icon"><i class="fas fa-heart"></i></div>
                        <div class="admin-card-value" id="stat-emotion">{{ analytics.most_common_emotion }}</div>
                        <div class="admin-card-label">Most Common Emotion</div>
                    </div>
                    <div class="admin-card glass">
                        <div class="admin-card-icon"><i class="fas fa-broadcast-tower"></i></div>
                        <div class="admin-card-value" id="stat-sessions">{{ analytics.active_sessions }}</div>
                        <div class="admin-card-label">Active Sessions</div>
                    </div>
                </div>
            </section>

            <!-- Users -->
                <section id="section-users" class="admin-section">
                    <h1>User Management</h1>
                    <p class="admin-subtitle">Paginated list with search and join date</p>
                    <div class="admin-toolbar">
                        <input type="text" id="user-search" class="admin-input" placeholder="Search username or email...">
                        <button type="button" class="admin-btn" id="users-refresh">Refresh</button>
                    </div>
                    <div class="admin-table-wrap glass">
                        <table class="admin-table">
                            <thead>
                                <tr><th>ID</th><th>Username</th><th>Email</th><th>Role</th><th>Status</th><th>Scans</th><th>Joined</th><th></th></tr>
                            </thead>
                            <tbody id="users-tbody"></tbody>
                        </table>
                        <div class="admin-pagination" id="users-pagination"></div>
                    </div>
                    <!-- Daily and Monthly Reports Section -->
                    <div class="admin-reports glass">
                        <h2>Daily & Monthly Reports</h2>
                        <div id="reports-list">
                            <!-- Reports will be loaded here by admin.js -->
                        </div>
                        <!-- Danger note for emotional health faults -->
                        <div class="danger-note">
                            <!-- If month is over, show danger note -->
                            <!-- Otherwise, comment: Month is still ongoing -->
                            <!-- <span class="danger-text">Warning: Emotional health fault detected for user [username] in [month]. Immediate attention required.</span> -->
                            <!-- <span class="info-text">Month is still ongoing. Danger note will appear if faults are detected at month end.</span> -->
                        </div>
                    </div>
                </section>

            <!-- Emotion Logs -->
            <section id="section-emotions" class="admin-section">
                <h1>Emotion Logs</h1>
                <p class="admin-subtitle">Filter and moderate</p>
                <div class="admin-toolbar filters">
                    <select id="filter-emotion" class="admin-select">
                        <option value="">All emotions</option>
                        <option value="happy">happy</option>
                        <option value="neutral">neutral</option>
                        <option value="calm">calm</option>
                        <option value="sad">sad</option>
                        <option value="angry">angry</option>
                        <option value="focused">focused</option>
                    </select>
                    <input type="date" id="filter-date-from" class="admin-input">
                    <input type="date" id="filter-date-to" class="admin-input">
                    <input type="number" id="filter-confidence" class="admin-input" placeholder="Min confidence" step="0.01" min="0" max="1">
                    <button type="button" class="admin-btn" id="emotions-refresh">Apply</button>
                </div>
                <div class="admin-table-wrap glass">
                    <table class="admin-table">
                        <thead>
                            <tr><th>ID</th><th>User</th><th>Emotion</th><th>Confidence</th><th>Date</th><th></th></tr>
                        </thead>
                        <tbody id="emotions-tbody"></tbody>
                    </table>
                    <div class="admin-pagination" id="emotions-pagination"></div>
                </div>
            </section>

            <!-- Features -->
            <section id="section-features" class="admin-section">
                <h1>Feature Control</h1>
                <p class="admin-subtitle">Enable or disable system modules</p>
                <div class="admin-table-wrap glass">
                    <table class="admin-table">
                        <thead>
                            <tr><th>Feature</th><th>Status</th></tr>
                        </thead>
                        <tbody id="features-tbody"></tbody>
                    </table>
                    <button type="button" class="admin-btn" id="features-save">Save changes</button>
                </div>
            </section>

            <!-- Recommendations -->
                <section id="section-recommendations" class="admin-section">
                    <h1>Recommendation Mappings</h1>
                    <p class="admin-subtitle">Emotion â†’ suggestion text (Admin can edit references)</p>
                    <div class="admin-table-wrap glass">
                        <table class="admin-table">
                            <thead>
                                <tr><th>Emotion</th><th>Content</th><th></th></tr>
                            </thead>
                            <tbody id="recommendations-tbody"></tbody>
                        </table>
                        <div class="admin-recommendations-actions">
                            <button type="button" class="admin-btn" id="rec-add-row">Add row</button>
                            <button type="button" class="admin-btn primary" id="rec-save">Save all</button>
                        </div>
                    </div>
                    <!-- Demo image placeholder for admin reference editing -->
                    <!-- <img src="/static/admin/demo-reference.jpg" alt="Demo Reference" style="display:none" /> -->
                </section>

            <!-- Logs -->
            <section id="section-logs" class="admin-section">
                <h1>System Logs</h1>
                <p class="admin-subtitle">Recent activity</p>
                <div class="admin-table-wrap glass">
                    <ul id="logs-list" class="admin-logs-list"></ul>
                </div>
            </section>
        </main>
    </div>

    <!-- User edit modal -->
    <div id="user-modal" class="admin-modal">
        <div class="admin-modal-content glass">
            <div class="admin-modal-header">
                <h3>Edit User</h3>
                <button type="button" class="admin-modal-close" data-close="user-modal">&times;</button>
            </div>
            <div class="admin-modal-body">
                <input type="hidden" id="modal-user-id">
                <label>Username</label>
                <input type="text" id="modal-username" class="admin-input full">
                <label>Email</label>
                <input type="email" id="modal-email" class="admin-input full">
                <label>Role</label>
                <select id="modal-role" class="admin-select full">
                    <option value="user">user</option>
                    <option value="admin">admin</option>
                </select>
                <label class="admin-checkbox-label"><input type="checkbox" id="modal-is-active" checked> Account active</label>
                <p class="admin-modal-meta" id="modal-meta"></p>
            </div>
            <div class="admin-modal-footer">
                <button type="button" class="admin-btn" data-close="user-modal">Cancel</button>
                <button type="button" class="admin-btn primary" id="user-save">Save</button>
                <button type="button" class="admin-btn danger" id="user-deactivate">Deactivate user</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='admin/admin.js') }}"></script>
</body>
</html>
