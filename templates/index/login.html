<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../static/index/index.css" />
  <title>Wellness Login</title>
</head>
<body>
<canvas id="neural-bg"></canvas>
<a href="{{ url_for('home') }}" class="back-btn">← Back</a>

<!-- Main Layout -->
<main class="split-container">

  <!-- LEFT: Login Section -->
  <section class="left-section reveal">
    <h1>Start Your Wellness Journey</h1>
    <p class="subtitle">
      Sign in to access your personalized emotional wellness dashboard
    </p>

    <div class="auth-card">

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="showLogin()">Login</button>
        <button class="tab" onclick="showRegister()">Register</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="form active">
        <label>Email</label>
        <input id="email" type="email" placeholder="Enter your email" required />

        <label>Password</label>
        <input id="password"  type="password" placeholder="Enter your password" required />

        <!-- Face Detection & Emotion Section -->


        <button type="button" class="primary-btn" onclick="login()">
          Sign In →
        </button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" class="form hidden">
        <label>Full Name</label>
        <input type="text" placeholder="Enter your full name" required />

        <label>Email</label>
        <input type="email" placeholder="Enter your email" required />

        <label>Password</label>
        <input type="password" placeholder="Create a password" required />

        <button type="button" class="primary-btn" onclick="register()">
            Create Account →
        </button>

      </form>

      <div class="divider">OR</div>

      <button class="viewer-btn" onclick="window.location.href='{{ url_for('health_tips') }}'">Continue as Viewer</button>

      <div class="divider"></div>

      <!-- ADMIN LOGIN -->
      <button class="admin-btn" onclick="goToAdminLogin()">
        Login as Admin
      </button>

    </div>
  </section>

  <!-- RIGHT: Video Section -->
<section class="right-section">
  <video autoplay muted loop playsinline>
    <source src="https://res.cloudinary.com/dkjp9svlj/video/upload/w_854,q_auto:eco,f_auto,vc_auto/v1771333621/wellness_cobm6j.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <div class="video-overlay">
    <h2>Understand • Analyze • Heal</h2>
    <p>AI-powered emotional wellness platform</p>
  </div>
</section>

</main>
<script src="../../static/index/script.js"></script>
<script type="module" src="../../static/index/neural-bg.js"></script>
<!-- Music Player Script -->
<script src="../../static/music_player.js"></script>

<script>
// Face detection and emotion detection logic
let stream = null;
function startFaceDetection() {
  const cameraContainer = document.getElementById('camera-container');
  cameraContainer.style.display = 'block';
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(s => {
      stream = s;
      document.getElementById('camera').srcObject = stream;
    })
    .catch(err => {
      alert('Camera access denied.');
    });
}

function captureAndAnalyzeFace() {
  const video = document.getElementById('camera');
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth || 180;
  canvas.height = video.videoHeight || 140;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  const dataUrl = canvas.toDataURL('image/png');

  // Send image to backend for emotion detection
  fetch('/api/face/analyze', {
    method: 'POST',
    body: createFormDataFromBase64(dataUrl),
  })
    .then(res => res.json())
    .then(data => {
      // Show emotion and accuracy
      const resultDiv = document.getElementById('emotion-result');
      if (data.emotion || data.dominantEmotion) {
        resultDiv.innerHTML = `<span class="emotion-label">Emotion: ${data.emotion || data.dominantEmotion}</span><br><span class="emotion-accuracy">Accuracy: ${data.accuracy ? (data.accuracy*100).toFixed(2)+'%' : 'N/A'}</span>`;
        resultDiv.classList.add('show');
      } else {
        resultDiv.innerHTML = 'No face detected.';
        resultDiv.classList.remove('show');
      }
      // CSS effect
      resultDiv.style.background = '#fff';
      resultDiv.style.color = '#4c1d95';
      resultDiv.style.borderRadius = '8px';
      resultDiv.style.padding = '8px 12px';
      resultDiv.style.boxShadow = '0 2px 8px #a855f7';
    })
    .catch(() => {
      document.getElementById('emotion-result').innerHTML = 'Error analyzing face.';
    });
}

function createFormDataFromBase64(dataUrl) {
  // Convert base64 to Blob
  const arr = dataUrl.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  for (let i = 0; i < n; i++) u8arr[i] = bstr.charCodeAt(i);
  const blob = new Blob([u8arr], { type: mime });
  const formData = new FormData();
  formData.append('image', blob, 'face.png');
  return formData;
}
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../static/index/index.css" />
  <title>Wellness Login</title>
</head>
<body>
<canvas id="neural-bg"></canvas>
<a href="{{ url_for('home') }}" class="back-btn">← Back</a>

<!-- Main Layout -->
<main class="split-container">

  <!-- LEFT: Login Section -->
  <section class="left-section reveal">
    <h1>Start Your Wellness Journey</h1>
    <p class="subtitle">
      Sign in to access your personalized emotional wellness dashboard
    </p>

    <div class="auth-card">

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="showLogin()">Login</button>
        <button class="tab" onclick="showRegister()">Register</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="form active">
        <label>Email</label>
        <input id="email" type="email" placeholder="Enter your email" required />

        <label>Password</label>
        <input id="password"  type="password" placeholder="Enter your password" required />

        <button type="button" class="primary-btn" onclick="login()">
          Sign In →
        </button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" class="form hidden">
        <label>Full Name</label>
        <input type="text" placeholder="Enter your full name" required />

        <label>Email</label>
        <input type="email" placeholder="Enter your email" required />

        <label>Password</label>
        <input type="password" placeholder="Create a password" required />

        <button type="button" class="primary-btn" onclick="register()">
            Create Account →
        </button>

      </form>

      <div class="divider">OR</div>

      <button class="viewer-btn" onclick="window.location.href='/health-tips'">Continue as Viewer</button>

      <div class="divider"></div>

      <!-- ADMIN LOGIN -->
      <button class="admin-btn" onclick="goToAdminLogin()">
        Login as Admin
      </button>

    </div>
  </section>

  <!-- RIGHT: Video Section -->
<section class="right-section">
  <video autoplay muted loop playsinline poster="{{ url_for('static', filename='login.mp4') }}" style="width:100%;height:100%;object-fit:cover;">
    <source src="{{ url_for('static', filename='login.mp4') }}" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
  <div class="video-overlay">
    <h2>Understand • Analyze • Heal</h2>
    <p>AI-powered emotional wellness platform</p>
  </div>
</section>

</main>
<script src="../../static/index/script.js"></script>
<script type="module" src="../../static/index/neural-bg.js"></script>
<!-- Music Player Script -->
<script src="../../static/music_player.js"></script>
</body>
</html>
